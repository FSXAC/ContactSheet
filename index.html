<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Sheet Generator</title>
    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://unpkg.com/98.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="ui-desktop" style="left: 0; top: 0;">
		<div class="recycle-bin ui-icon">
			<div class="ui-icon-container">
				<img width="32" height="32" src="recycle_bin_empty_cool-5.png">
				<span style="color:white;">Recycle Bin</span>
			</div>
		</div>
		<div class="recycle-bin ui-icon">
			<div class="ui-icon-container">
				<img width="32" height="32" src="computer_explorer_cool-5.png">
				<span style="color:white;">Computer</span>
			</div>
		</div>
		<div class="recycle-bin ui-icon">
			<div class="ui-icon-container">
				<img width="32" height="32" src="directory_closed-3.png">
				<span style="color:white;">Documents</span>
			</div>
		</div>
		<div class="recycle-bin ui-icon">
			<div class="ui-icon-container">
				<a href="https://muchen.ca">
					<img width="32" height="32" src="html2-1.png">
					<span style="color:white;">muchen.ca</span>
				</a>
			</div>
		</div>		
	</div>

    <div class="ui-desktop" style="left:256px; top:128px;">
        <div class="recycle-bin ui-icon">
			<div class="ui-icon-container">
				<img width="32" height="32" src="sc3k.png">
				<span style="color:white;">SimCity 3000</span>
			</div>
		</div>
    </div>

    <div id="welcome" class="window mt-5 mx-auto" style="width: 600px">
        <div class="title-bar">
        
          <div class="title-bar-text">
            <img src="kodak_imaging-1.png"><span class="padded">ContactSheet Generator v0.1</span>
        </div>
          <div class="title-bar-controls">
            <!-- <button aria-label="Minimize"></button>
            <button aria-label="Maximize"></button> -->
            <button aria-label="Help" onclick="displayTodo()"></button>
            <button aria-label="Close"></button>
          </div>
        </div>
        <div class="window-body">
            <div class="mb-4">
                <img src="cover.png" style="width:100%" alt="">
                <span style="float: right">Original image by Muchen He</span>
            </div>
            <p>
                This utility generates a filmic contact sheet from a folder of pictures with realistic
                film borders, DX codes, and frame counters. 
                Film stock properties are based on real film stocks.
                Future versions will include more film stocks and options for output resolution.
                Web theme is inspired by the retro Windows 98 using <a href="https://jdan.github.io/98.css/#components">98.css</a>.
                Render of filmstrip and contact sheet is done using <a href="https://p5js.org/">p5.js</a>.
                Windows 98 icons by <a href="https://win98icons.alexmeub.com/">Alex Meub</a>.
                This work is licensed under <a href="LICENSE">the MIT License</a>.
            </p>
            <p>Made with &lt;3 by <a href="https://muchen.ca">Muchen</a>.</p>
            <p>Click the "Let's Go" button to start.</p>

            <!-- <marquee behavior="scroll" direction="left" scrollamount="3" class="mb-1">
                Welcome to the future of the web! This is a test of the emergency broadcast 
                system. You've got mail! Welcome to the world wide web!
                You are the 1,000,000th visitor! Click here to claim your prize!
                Peanut butter jelly time! All your base are belong to us!
            </marquee> -->
            <section class="field-row">
                <button id="welcome-button" onclick="welcome_start()">Let's Go</button>
            </section>
        </div>
    </div>

    <div class="window hidden" id="upload">
        <div class="title-bar">
            <div class="title-bar-text">Load Images</div>
            <div class="title-bar-controls">
                <button onclick="reset()" aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">
            <p>"Upload" a folder of images to generate a contact sheet.</p>
            <div class="my-3">
                <img src="msg_information-0.png" alt="" style="float: left" class="mr-1">
                <p>For best results, use a folder of images with a consistent aspect ratio (3:2) and keep number of images between 12 to 40.</p>
                <p>No images will be uploaded to the server. All processing is done locally in your browser.</p>
            </div>
            <input type="file" id="uploadImageButton" webkitdirectory mozdirectory msdirectory odirectory directory multiple/>
            <!-- <section class="field-row">
                <button id="uploadOKButton" class="btn btn-primary" onclick="uploadImages()" disabled>OK</button>
            </section> -->
        </div>  
    </div>

    <div class="window hidden" id="uploadProgress">
        <div class="title-bar">
            <div class="title-bar-text">Processing</div>
        </div>
        <div class="window-body">
            <img src="tshell32_168.gif" alt="">
            <p>Processing images...</p>
            <p id="uploadProgressText" class="progress-bar-text"></p>
            <div class="progress">
                <div id="uploadProgressBar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <!-- <script>
                // test progress bar
                // run when document is ready
                document.addEventListener("DOMContentLoaded", function() {
                    var elem = document.getElementById("uploadProgressBar");
                    var elemText = document.getElementById("uploadProgressText");
                    var width = 0;
                    var id = setInterval(frame, 10);
                    function frame() {
                        if (width >= 100) {
                            width = 0;
                        } else {
                            width++;
                            elem.style.width = width + "%";
                            elemText.innerHTML = width + "%";
                        }
                    }
                });
            </script> -->
        </div>
    </div>

    <div class="window hidden" id="imagePreviewWindow">
        <div class="title-bar">
            <div class="title-bar-text">Image Preview</div>
                <div class="title-bar-controls">
                <button aria-label="Minimize"></button>
                <button aria-label="Maximize"></button>
                <button onclick="reset()" aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">

            <div id="imagePreview">
                <p>No images</p>
            </div>

            <section class="field-row">
                <!-- TODO: reset 2 -->
                <button id="imagePreviewCancel" onclick="reset()">Start Over</button>
                <button id="imagePreviewProceed" onclick="showFilmstrip()">Continue</button>
            </section>
        </div>
            
    </div>

    <div class="window hidden" id="filmstripPreviewWindow">
        <div class="title-bar">
            <div class="title-bar-text">Filmstrip Preview</div>
                <div class="title-bar-controls">
                <button aria-label="Minimize"></button>
                <button aria-label="Maximize"></button>
                <button onclick="hideFilmstrip()" aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">
            <div id="filmstripPreview">
                <div class="my-3">
                    <button id="refreshButton" onclick="refreshImages()">Refresh</button>
                    <button id="previewButton" onclick="previewDraw();">Preview</button>
                    <button id="generateButton" onclick="showContactSheet();">Generate!</button>
                    <!-- <p>Tip: use the scroll bar to scoll horizontally</p> -->
                </div>
                <div class="pb-2" style="overflow-x: scroll;">
                    <img src="#" alt="" id="filmstripimg">
                </div>
                <!-- <canvas class="my-3" id="p5canvas"></canvas> -->
            </div>
        </div>
    </div>

    <div class="window hidden" id="contactSheetWindow">
        <div class="title-bar">
            <div class="title-bar-text">Contact Sheet</div>
                <div class="title-bar-controls">
                <button aria-label="Minimize"></button>
                <button aria-label="Maximize"></button>
                <button onclick="hideContactSheet()" aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">
            <img src="#" alt="" id="contactsheetimg">
        </div>
    </div>


    <!-- todo -->
    <div class="window hidden" id="todoWindow">
        <div class="title-bar">
            <div class="title-bar-text">To Do</div>
                <div class="title-bar-controls">
                <button aria-label="Minimize"></button>
                <button aria-label="Maximize"></button>
                <button onclick="reset()" aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">
            <ul class="tree-view">
                <li>Improve UI/UX
                    <ul>
                        <li><del>Add loading/progress bars</del></li>
                        <li><del>Make it look more like Windows 98 (retro)</del></li>
                        <li>Add fun decorations like Win98 desktop</li>
                        <li>Improve user flow</li>
                    </ul>
                </li>
                <li>
                    Customizable options
                    <ul>
                        <li>Add options for output resolution</li>
                        <li>Add other film stocks</li>
                        <li>Add togglable options</li>
                        <li>Add fun effects
                            <ul>
                                <li>Light leaks</li>
                                <li>Scratches</li>
                                <li>Grain</li>
                                <li>Dusts</li>
                            </ul>
                        </li>
                    </ul>
                </li>

                <li>Improve performance
                    <ul>
                        <li>Make this run faster</li>
                        <li>Clean up code</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div class="start-bar">
		<a href="https://alexmeub.com/old-windows-icons/" title="Start Menu" class="button start-button-wrapper js-start-button" target="_blank">
			<div class="start-button"></div>
		</a>
        <img class="start-bar-icon mr-2 ml-2" src="desktop_old-1.png" alt="">
        <img class="start-bar-icon mr-2" src="msie2-1.png" "alt="">

		<span class="start-bar-window mx-1">
            <img class="start-bar-icon mr-2" src="msie2-1.png" alt="">Internet Explorer
        </span>

        <span class="start-bar-window active mx-1">
            <img class="start-bar-icon mr-2" src="kodak_imaging-1.png" alt="">ContactSheet Generator v0.1
        </span>

	</div>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- p5.js -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.js"></script>

    <script src="filmstock_properties.js"></script>
    <script src="dxcode.js"></script>
    <script src="contact_sheet.js"></script>
    <script>
        function welcome_start() {
            // set welcome button to active state by adding pseudo class
            // document.getElementById("welcome-button").classList.add("active");
            document.getElementById("welcome-button").classList.add("p-active");
            // set mouse cursor to loading
            document.body.style.cursor = "wait";
            load_p5_resources();

            setTimeout(() => {
                
                document.getElementById("welcome").classList.add("inactive");
                document.getElementById("upload").classList.remove("hidden");
                document.getElementById("welcome-button").classList.remove("p-active");
                document.body.style.cursor = "default";
            }, 400);
            // document.getElementById("welcome").classList.add("inactive");
            // document.getElementById("main_container").classList.remove("hidden");
        }

        function displayTodo() {
            document.getElementById("todoWindow").classList.remove("hidden");
        }

        function reset() {
            document.getElementById("welcome").classList.remove("inactive");

            document.getElementById("upload").classList.add("hidden");
            document.getElementById("uploadProgress").classList.add("hidden");
            document.getElementById("imagePreviewWindow").classList.add("hidden");
            document.getElementById("filmstripPreviewWindow").classList.add("hidden");
            document.getElementById("contactSheetWindow").classList.add("hidden");
            document.getElementById("todoWindow").classList.add("hidden");
        }

        function startLoad() {
            document.getElementById("upload").classList.add("inactive");
            document.getElementById("uploadProgress").classList.remove("hidden");
        }

        function finishLoad() {
            document.getElementById("uploadProgress").classList.add("hidden");
            document.getElementById("imagePreviewWindow").classList.remove("hidden");
        }

        function showFilmstrip() {
            document.getElementById("filmstripPreviewWindow").classList.remove("hidden");
        }

        function hideFilmstrip() {
            document.getElementById("filmstripPreviewWindow").classList.add("hidden");
        }

        function showContactSheet() {
            document.getElementById("contactSheetWindow").classList.remove("hidden");
        }

        function hideContactSheet() {
            document.getElementById("contactSheetWindow").classList.add("hidden");
        }

        window.addEventListener("DOMContentLoaded", (event) => {
            console.log("DOM fully loaded and parsed");
            addUploaderEventListener();
        });
    </script>
    <script src="image_loader.js"></script>

</body>

</html>
    </script>

</body>

</html>